name: Backend Segur-App CI/CD

on:
  push:
    branches: [master]

jobs:
  deploy:
    name: Deploy on render.
    runs-on: ubuntu-latest

    steps: 
      - name: Deploy to production
        uses: johnbeynon/render-deploy-action@v0.0.8
        with:
          render_account_id: ${{ secrets.RENDER_ACCOUNT_ID }}
          render_token: ${{ secrets.RENDER_TOKEN }}

  push_to_registry:
        name: Push Docker image to Docker Hub
        runs-on: ubuntu-latest
        steps:

          - name: Check out the repo
            uses: actions/checkout@v3
          
          - name: Log in to Docker Hub
            uses: docker/login-action@f054a8b539a109f9f41c372932f1ae047eff08c9
            with:
              username: ${{ secrets.DOCKER_USERNAME }}
              password: ${{ secrets.DOCKER_PASSWORD }}
          
          - name: Extract metadata (tags, labels) for Docker
            id: meta
            uses: docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38
            with:
              images: cristianmachuca/segurapp

          - name: Build and push Docker image
            uses: docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc
            with:
              context: .
              push: true
              tags: ${{ steps.meta.outputs.tags }}
              labels: ${{ steps.meta.outputs.labels }}